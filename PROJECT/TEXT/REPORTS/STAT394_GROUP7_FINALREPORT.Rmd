---
title: "Tasmanian Lakes / Final Report / STAT394"
author: "Group 7 / Jack Foley / Hunter Stent / Yiyang Chen"
date: "`r Sys.Date()`"
output: bookdown::pdf_document2

header-includes:
    - \usepackage{newpxtext,eulerpx}
    - \usepackage{bm,bbm}
    - \usepackage{palatino}
    - \renewcommand{\familydefault}{\sfdefault} % sans serif
    - \fontfamily{ppl}\selectfont
    - \usepackage{float}
    - \floatplacement{figure}{H}
    - \usepackage{booktabs}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(klaR)
library(readxl)
library(ggplot2)
library(ggExtra)
library(GGally)
library(ggbiplot)
library(ggpubr)
library(factoextra)
library(vegan)
library(dendextend)
library(ggpubr)
library(cluster)
library(e1071)
library(ggcorrplot)
library(rgl)
library(FSA)
library(maps)
set.seed(73942022, kind="Mersenne-Twister")
```

``` {r echo=FALSE}

taslakes.data <- data.frame(read_excel("Tasmania_lakes_recoded.xlsx", sheet = 2))

GlaSed <- factor(taslakes.data$GlaSed)
Scrub <- factor(taslakes.data$Scrub)
Felsic <- factor(taslakes.data$Felsic)
Dolerite <- factor(taslakes.data$Dolerite)
Elevation <- taslakes.data$Elev
Depth <- taslakes.data$Depth
pH <- taslakes.data$pH
WaterTemp <- taslakes.data$Twater
Precipitation <- taslakes.data$Precip
Turbidity <- taslakes.data$Turbid
LakeArea <- taslakes.data$Lake_Area
Lake <- taslakes.data$Lake
TylerLine <- factor(taslakes.data$TylerLine)
EDMS <- taslakes.data$EDMS
SDMS <- taslakes.data$SDMS

taslakes.df <- data.frame(Lake, Elevation, Depth, pH, WaterTemp, Precipitation, Turbidity, GlaSed, Scrub, Felsic, Dolerite, LakeArea, TylerLine)
```
\newpage

# Introduction 

## Context and Motivation

Freshwater restoration is an increasingly important focus of environmental management around the world. Poor water quality in lakes and rivers is often attributed to human-driven processes, including land-use change and pollutant run-off (Heino et al., 2020). However, natural (non-human) factors may also play a non-negligible role, and may mean that water quality indicators vary greatly between freshwater systems even under pre-human or non-human conditions (Rees et al., 2015). Time and resources are  often at risk of being wasted if, for example, restoration efforts misinterpret a naturally acidic lake as a system degraded by chemical pollution and in need of intervention. Moreover, these restoration efforts are often guided by broad, national-scale water quality standards may that overlook this natural variation entirely (Tibebe et al., 2019).

Grouping freshwater systems together based on the key natural variables that drive water quality variation is preferable, as this would produce more specific and appropriate management targets and minimize unnecessary resource-wasting intervention. However, out in the field this classification process would require demanding and repetitive data collection for each new lake that one wishes to examine. Statistical classification techniques that build on a smaller set of existing data may provide a more much efficient solution.   

The data set of Tasmanian lakes, courtesy of Rees et al. (2008), features a comprehensive collection of lake variables in a setting characterized by highly-variable natural factors. 63 environmental variables are provided for 50 lakes in Tasmania, Australia, of which 13 were flagged by the researchers as key data These include contextual lake information and natural factors (e.g. elevation, underlying rock type, lake area) alongside variables traditionally interpreted as water quality indicators (e.g. pH, turbidity, water temperature). Geological and topographical processes have meant that natural factors in Tasmania are strongly diverse  either side of a semi-distinct north-south line, known as Tyler's Line (Rees & Cwynar, 2010). This division is characterised by changes in precipitation, wind patterns and rock type, particularly Dolerite.

Exemplifying the management problem, treating all 50 lakes with the same restoration standards given the natural variation would be a poor and cost-inefficient decision. For example, Rees and Cwynar (2010) also presented preliminary findings into how variations in rock type may cause some lakes in Tasmania to be naturally more acidic. Efforts to raise the pH of this group of lakes back up to an overall Tasmanian average or nationally-homogeneous pH standard would be unnecessary and waste resources that could be better allocated elsewhere.

The data therefore present a novel opportunity to examine whether distinct sub-groupings of lakes can be identified from within the sampled 50, and, if so, whether natural factors are driving variation in water quality indicators between the groups. Developing statistical classification techniques would allow for other Tasmanian lakes to be easily incorporated into an existing group in the future, for which specific and appropriate water quality guidelines would have been established. 

## Leading Question

Given the existing problem in freshwater management, and the opportunity presented by the Tasmanian lake data set, this report aims to examine the following two-part leading question: 

***Can multivariate classification techniques accurately partition Tasmanian lakes and, if so, which natural factors or water quality indicators are characterizing the groupings?***

## Map of 50 Lakes in Tasmania, Australia

```{r Figure1, fig.cap="Map of 50 Tasmanian Lakes available in the Rees et al. (2008) data set, including Tyler's Line (red)", out.width = "650px", echo=FALSE}

world_map <- map_data("world")
Australia <- subset(world_map, world_map$region=="Australia")
Aus_143 <- subset(Australia, Australia$group==143)

p <- ggplot() + coord_fixed() +
  xlab("") + ylab("")

base_world_tas <- p + geom_polygon(data=Aus_143, aes(x=long, y=lat, group=group), 
                               colour="light green", fill="white")
tas_world <- 
  base_world_tas +
  geom_point(data=taslakes.df, 
             aes(x=EDMS, y=SDMS, size=LakeArea), each=2,pch=1, alpha=.7) +
  geom_vline(xintercept = 146, color = "red", size = 1, ymin=-44,ymax=-41) + 
  labs(size = "Lake Area (km^2)")

tas_world
```

Figure&nbsp;\@ref(fig:Figure1) provides an overview of spatial distribution of the 50 lakes against a stylised map of Tasmania, Australia. Though coverage across the island is not even (higher density of lakes towards the East), lakes either side Tyler's Line appear represented. 

# Methodology  

## Key Methods: Descriptions and Justifications

Two classification techniques will be used to distinguish three sets of possible lake sub-grouping from within the data set: \newline \newline
- **Linear Discriminant Analysis** (*Dolerite presence/absence*)\newline
- **Linear Discriminant Analysis** (*east/west of Tyler's Line*)\newline
- **Cluster Analysis** (*k-means and k-medoids*)\newline

### Discriminant Analyses
Two Linear Discriminant Analyses (LDAs) are used to ultilise already-established partitions within the data set and  existing literature. A multiple density plot in Figure&nbsp;\@ref(fig:Figure4)  provided some informal evidence that lakes with Dolerite rock may systematically have different pH levels (a key water quality indicator) than lakes without Dolerite. Similarly, Figure&nbsp;\@ref(fig:Figure5) showed that lakes East of Tyler's Line may have systematically different pH levels than lakes West of the line. Tyler's Line has been previously explored as a classifier for Tasmanian lakes by Rees and Cwynar (2010), so this report hypotheses that it will perform better than a Dolerite partition.

LDAs were the selected discriminant method as exploratory investigations (see Figure&nbsp;\@ref(fig:Figure3)) revealed variable distributions that were not well modelled (as Normal, or otherwise). Moreover, covariance matrices for pairs within both LDAs (Dolerite vs Not Dolerite, and East vs West of Tyler's Line) appeared approximately equal, and the sub-group separation within the multiple density plots (Figure&nbsp;\@ref(fig:Figure4), Figure&nbsp;\@ref(fig:Figure5)) also suggested a linear partition may be possible.

A 0.75 / 0.25 probability split was used to generate the training and test sets, respectively, for the LDAs. This attempts to balance maximizing the number of lakes available to train the classifier - which would build a more accurate tool for incorporating future lakes - with the need to evaluate classifier performance with a sufficient test set. The small total sample size (50 lakes) was a clear limitation in this regard. Two key water quality indicators are used on the partition plot axes (pH, Turbidity) as these are the variables that may require unique consideration for the environmental management of each group.

### Cluster Analyses
A cluster analysis is subsequently performed, motivated in part by a factor analysis that revealed three factors were the minimum required to sufficiently explain variation across the lakes (three factors exceeds the single factor used in each LDA to partition the lakes). Unlike the two LDAs, the cluster analysis has less potential for helping to classify future lakes, but may more meaningfully identify existing lake sub-groupings. This is because the clustering algorithms allow for all variables to potentially contribute to the classification process. A k-medoid clustering algorithm was used to mitigate any particularly influential lakes, but is provided alongside a k-means output to demonstrate cluster robustness. A Ward linkage method is used to construct an accompanying dendrogram as this preserves the same centroid-based clustering as demonstrated by k-medoid.  

Both k-medoid and k-means algorithms generated one cluster populated only by one lake ('Men3'). This lake, which was exceptionally different from the other 49, was subsequently removed and the clustering analysis re-run. This report justifies the removal by citing the practical inefficiencies of having to establish and implement a new set of water quality guidelines just for that one lake. Four clusters (demanding four sets of water quality guidelines) able to capture 49 lakes is preferable to five clusters capturing 50 lakes.

ANOVA and (where ANOVA assumptions are violated) non-parametric Kruskall-Wallis tests then unpack variation across the clusters produced in the previous analysis, followed by corresponding pairwise tests if appropriate. Unlike the original variables, which Figure&nbsp;\@ref(fig:Figure3) shows are either quite skewed or bimodal, the variables broken down by clusters exhibit more Gaussian distributions and similar variances, motivating the ANOVA comparison. However, square root transformations are used when such transformations improve the confidence in upholding ANOVA assumptions. Testing of these assumptions (Shapiro-Wilk tests, Bartlett tests) are provided in the Appendix. The most interesting variables that display between-cluster variation are presented in this report.

Key variables that distinguish clusters from one another are identified, to inform how that particular cluster should be managed in regards to setting water quality standards. 

## Important Code for Reproducibility 

### Data Set-Up

The following packages are necessary for various stages in the data set-up, visualisation or analyses. 

``` {r echo=TRUE}
library(klaR)
library(readxl)
library(ggplot2)
library(ggExtra)
library(GGally)
library(ggbiplot)
library(ggpubr)
library(factoextra)
library(vegan)
library(dendextend)
library(ggpubr)
library(cluster)
library(e1071)
library(ggcorrplot)
library(rgl)
library(FSA)
library(maps)
```

After syncing the corresponding GitHub repository, data set can be sourced through the relative path provided below, with the 13 variables of interest extracted and loaded into a data frame. This facilitates all subsequent analyses.

``` {r echo=TRUE}

taslakes.data <- data.frame(read_excel("Tasmania_lakes_recoded.xlsx", 
                                       sheet = 2))

GlaSed <- factor(taslakes.data$GlaSed)
Scrub <- factor(taslakes.data$Scrub)
Felsic <- factor(taslakes.data$Felsic)
Dolerite <- factor(taslakes.data$Dolerite)
Elevation <- taslakes.data$Elev
Depth <- taslakes.data$Depth
pH <- taslakes.data$pH
WaterTemp <- taslakes.data$Twater
Precipitation <- taslakes.data$Precip
Turbidity <- taslakes.data$Turbid
LakeArea <- taslakes.data$Lake_Area
Lake <- taslakes.data$Lake
TylerLine <- factor(taslakes.data$TylerLine)

taslakes.df <- data.frame(Lake, Elevation, Depth, pH, WaterTemp, 
                          Precipitation, Turbidity, GlaSed, Scrub, 
                          Felsic, Dolerite, LakeArea, TylerLine)
```

A seed is set as per below, necessary to replicate the random generation of train and test sets in the LDA. 

``` {r echo=TRUE}
set.seed(73942022, kind="Mersenne-Twister")
```

### Exploratory Data Analyses 

A multiple density plots presented in Figure&nbsp;\@ref(fig:Figure4) and Figure&nbsp;\@ref(fig:Figure5) are very important for motivating the LDAs, and can be recreated with the code below.

``` {r echo=TRUE, fig.show='hide'}
# Dolerite Presence/Absence 
ggplot(taslakes.df, aes(x=pH, color=Dolerite, fill=Dolerite)) + 
  geom_density(alpha=.7)

# East/West of Tyler's Line 
ggplot(taslakes.df, aes(x=pH, color=TylerLine, fill=TylerLine)) + 
  geom_density(alpha=.7)
```

### Linear Disriminant Analyses 

The code necessary to recreate the training and sets is provided below.

``` {r echo=TRUE, fig.show='hide'}

ind.tas <- sample(c("Tr", "Te"),
                  nrow(taslakes.df),
                  replace=TRUE,
                  prob=c(.75, .25))

Train.tas <- taslakes.df[ind.tas=="Tr",]
Test.tas <- taslakes.df[ind.tas=="Te",]

# Training Set (34 Lakes)
Train.tas <- Train.tas[complete.cases(Train.tas), ]

# Test Set (16 Lakes)
Test.tas <- Test.tas[complete.cases(Test.tas), ]
```

The partition plots (provided in Figure&nbsp;\@ref(fig:Figure7) and Figure&nbsp;\@ref(fig:Figure10)) for the performance of both the Dolerite / Not Dolerite LDA and the Tyler's Line LDA can be generated with the code below. Both partition plots represent the classification of the test lake set.  

``` {r echo=TRUE, fig.show='hide'}

# Testing the Dolerite LDA: Test Partition Plot
levels(Test.tas$Dolerite) <- c("Not Dolerite", "Dolerite")
partimat(Dolerite ~ pH + Turbidity , data=Test.tas, method="lda")

# Testing the Tyler's Line LDA: Test Partition Plot
levels(Test.tas$TylerLine) <- c("East", "West")
partimat(TylerLine ~ pH + Turbidity , data=Test.tas, method="lda")
```

### Cluster Analyses

The cluster analysis can be re-created with the code provided below, including the necessary set-up and data transformations. The cluster plot can then be generated, with the aforementioned outlier lake removed.

``` {r echo=TRUE, fig.show='hide'}

# Extract and Scale Numerical Variables
taslakes.df.num <- taslakes.df[, -c(1,(8:11), 13)]
taslakes.df.num.sc <- scale(taslakes.df.num)

# Remove Outlier Lake
taslakes.df.num.sc.men3rem <- taslakes.df.num.sc[-32,]

# K-Medoid Clustering Algorithm 
taslakes.kmedoid.4.men3rem <- pam(taslakes.df.num.sc.men3rem, 4)

# Cluster Plot (Withour Outlier) 
fviz_cluster(taslakes.kmedoid.4.men3rem, data = taslakes.df.num.sc.men3rem,
             palette = c("green", "orange", "dark blue", "red", "dark green"), 
             geom = "point",
             ellipse.type = "norm", 
             ggtheme = theme_bw())
```

An example box-plot to illustrate variation between the clusters (here, with pH) can be generated with the code provided below. 

``` {r echo=TRUE, fig.show='hide', warning = FALSE}

# Remove Outlier Lake from Variable Data
pH.men3rem <- pH[-32]
Elevation.men3rem <- Elevation[-32]
Depth.men3rem <- Depth[-32]
WaterTemp.men3rem <- WaterTemp[-32]
Precipitation.men3rem <- Precipitation[-32]
Turbidity.men3rem <- Turbidity[-32]
LakeArea.men3rem <- LakeArea[-32]

# Extract Cluster Identifications
Clusters <- factor(taslakes.kmedoid.4.men3rem$cluster)

# Create Data Frame Box-Plot Generation
clusters.boxplot.df <- data.frame(Clusters, Elevation.men3rem, pH.men3rem,
                                  Depth.men3rem, WaterTemp.men3rem, 
                                  Turbidity.men3rem, LakeArea.men3rem)

# Generate pH - Cluster Box-Plot
ggplot(clusters.boxplot.df, aes(x=Clusters, y=pH.men3rem, 
  group=Clusters, color=Clusters)) + 
  geom_boxplot(notch = TRUE) + 
  xlab("Tasmanian Lake Clusters") + ylab("pH") 
```


# Results  

## Exploratory Data Analysis (Consolidated)

### Descriptive Summary Statistics

```{r echo=FALSE,include=FALSE}

range2 <- function(x) {
  range <- max(x) - min(x)
  return(range)
}

summary <- function(x){
  return(c(
    length(x),
    min(x),
    quantile(x, .25),
    median(x),
    quantile(x, .75),
    max(x),
    IQR(x),
    range2(x),
    mean(x),
    sd(x),
    skewness(x),
    kurtosis(x))
  )
}
```

Table&nbsp;\ref{tab:Table1}, below, presents a quantitative summary of the descriptive statistics for each of the seven numeric variables. 

```{r Table1, echo=FALSE, results = 'asis'}

taslakes.df.num <- taslakes.df[, -c(1,(8:11), 13)]

taslakes.summarytable <- apply(taslakes.df.num, summary, MARGIN=2)

taslakes.summarytable <- rbind(formatC(as.numeric(taslakes.summarytable[1,]),format="f",digits=0),
                  formatC(as.numeric(taslakes.summarytable[2,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[3,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[4,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[5,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[6,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[7,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[8,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[9,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[10,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[11,]),format="f", digits=2),
                  formatC(as.numeric(taslakes.summarytable[12,]),format="f", digits=2))


colnames(taslakes.summarytable) <- c("Elevation", "Depth", "pH", "Water Temp", "Precipitation", "Turbidity", "Lake Area")
rownames(taslakes.summarytable) <- c("Sample Size", "Minimum", "Lower Quartile", "Median", "Upper Quartile", "Maximum", "IQR", "Range", "Mean", "Standard Deviation", "Skewness", "Kurtosis")

knitr::kable(taslakes.summarytable,
             caption="Quantitative summary of numeric Tasmania lakes data", 
             format="latex", booktabs=TRUE, position = "h!")

```

Table&nbsp;\ref{tab:Table1} suggests that the different numeric variables may present different distributions. Turbidity, Depth and Lake Area seem the most asymmetric, with the highest 'skewness'. For each of these three variables, means are greater than medians, suggesting that the asymmetry follows a right-skew whereby a smaller number of highly turbid, deep and large lakes are in the sample. 

Turbidity also has a very high 'kurtosis', suggesting that its distribution is very tail-heavy. Precipitation and pH appear to be distributed the most symmetrically, with the smallest 'skewness' and means that more closely approximate their medians.

### Correlations

Figure&nbsp;\@ref(fig:Figure2), below, provides a visual interpretation of the correlation matrix.

```{r Figure2, fig.cap="Plot of the numeric Tasmania lakes data correlation matrix", fig.pos="center",echo=FALSE}

taslakes.cor.matrix <- matrix(c(cor(taslakes.df.num)), nrow=7)

colnames(taslakes.cor.matrix) <- c("Elevation", "Depth", "pH", "Water Temp", "Precipitation", "Turbidity", "Lake Area")
rownames(taslakes.cor.matrix) <- c("Elevation", "Depth", "pH", "Water Temp", "Precipitation", "Turbidity", "Lake Area")

ggcorrplot(cor(taslakes.cor.matrix),
           hc.order = TRUE,
           type = "lower", 
           legend.title ="Correlation", 
           outline.color = "black",
           ggtheme = theme_bw())
```

Some of the correlations presented in Figure&nbsp;\@ref(fig:Figure2) are expected, and some motivate further investigation. For example, Water Temperature appears to be strongly negatively correlated with Elevation, and Depth and Lake Area appear positively correlated. This implies that water temperature decreases as elevation increases and lakes with larger areas are usually deeper, both expected relationships.

Notably, Elevation appears to have a strong positive correlation with pH. This implies that as the elevation of lakes increases, pH increases and water temperature decreases. pH also appears to have a strong negative correlation with Precipitation. 

\newpage

### Bimodal Distributions

Figure&nbsp;\@ref(fig:Figure3), below, provides the pairs plot.

```{r Figure3, fig.cap="Pairs plot for numeric Tasmania lakes data", fig.pos="center",echo=FALSE}

ggpairs(taslakes.df.num)
```

Figure&nbsp;\@ref(fig:Figure3) provides more insight into the distributions of each variable, after preliminary interpretations were made from the summary statistics. Strong asymmetry is shown in several variables, including Turbidity, Depth and Lake Area. Though all other variables are less skewed, none of the seven appear to follow a Gaussian distribution.

pH appears to follow a bimodal distribution, which may indicate the presence of distinct sub-groups within the overall sample of 50 lakes. 

Figure&nbsp;\@ref(fig:Figure4) and Figure&nbsp;\@ref(fig:Figure5) examine how the bimodal distribution of pH may be explained by the presence of absence of Dolerite rock and/or a lake's location East or West of Tyler's Line, respectively. 

```{r Figure4, fig.cap="Multiple density plot of pH for the presence or absence of Dolerite", out.width = '77%',echo=FALSE}

taslakes.df$Dolerite <- factor(taslakes.df$Dolerite)

ggplot(taslakes.df, aes(x=pH, color=Dolerite, fill=Dolerite)) + 
  geom_density(alpha=.7)
```

Figure&nbsp;\@ref(fig:Figure4) provides a strong indication that the two groups of lakes (lakes with Dolerite rock, lakes without Dolerite rock) may have different mean pH. Specifically, lakes with Dolerite rock appear have have a higher pH with less variance than lakes without Dolerite. 

```{r Figure5, fig.cap="Multiple density plot of pH for lakes located East or West of Tyler's Line", out.width = '77%',echo=FALSE}

taslakes.df$TylerLine <- factor(taslakes.df$TylerLine)

ggplot(taslakes.df, aes(x=pH, color=TylerLine, fill=TylerLine)) + 
  geom_density(alpha=.7)
```

Figure&nbsp;\@ref(fig:Figure5) suggests that lakes East of Tyler's Line appear to have higher pH with less variance than lakes West of Tyler's Line. Figure&nbsp;\@ref(fig:Figure4) and Figure&nbsp;\@ref(fig:Figure5) motivate the use of Dolerite and Tyler's Line, respectively, as categorical variables with which to establish a discriminant function.

## Linear Discriminant Analyses 

### Dolerite LDA 

**Covariance Matrix Equality** \newline

The covariance matrices for lakes with and lakes without Dolerite rock were examined, as large differences would erode confidence in the LDA technique. The comparison is provided in the Appendix, and, in summary, revealed mostly small differences between the matrices. 

However, variable pairs that included Elevation or Precipitation produced more noticeable covariance differences between the groups. This suggests that variance between the groups may not be fully captured by the simple Dolerite / Not Dolerite split. The LDA will proceed but with this caution acknowledged.

**LDA Output**

The LDA output is provided below.
``` {r echo=FALSE}
set.seed(73942022, kind="Mersenne-Twister")

ind.tas <- sample(c("Tr", "Te"),
                  nrow(taslakes.df),
                  replace=TRUE,
                  prob=c(.75, .25))

Train.tas <- taslakes.df[ind.tas=="Tr",]
Test.tas <- taslakes.df[ind.tas=="Te",]

Train.tas <- Train.tas[complete.cases(Train.tas), ]
Test.tas <- Test.tas[complete.cases(Test.tas), ]

taslakes.LDA <- lda(Dolerite ~ Elevation + Depth + pH + WaterTemp + Precipitation +
                      Turbidity + GlaSed + Felsic + LakeArea + TylerLine, data=Train.tas)
levels(Train.tas$Dolerite) <- c("Not Dolerite", "Dolerite")
taslakes.LDA
```

The training set is composed of 34 lakes (0.75 probability of selection from the original 50) and the test set is composed of 16 (0.25 probability).

The prior probabilities in the training set are approximately equal: 0.559 (19 lakes) for Not Dolerite, and 0.441 (15 lakes) for Dolerite.

Two classes are provided (Dolerite and Not Dolerite), so one linear discriminant function is provided to split the feature space of observations. 
\newline

**Training Partition Plot** 

```{r Figure6, fig.cap="Partition plot for the training set of Dolerite (D) vs Non Dolerite (N) lakes against water quality indicators pH and Turbidity", fig.pos="center",echo=FALSE}

levels(Train.tas$Dolerite) <- c("Not Dolerite", "Dolerite")
partimat(Dolerite ~ pH + Turbidity , data=Train.tas, method="lda")
```

Figure&nbsp;\@ref(fig:Figure6) demonstrates the reasonable accuracy by which the training set of lakes can be partitioned with a linear function based on the presence or absence of Dolerite rock. 

pH appears to control the partition (over Turbidity, another water quality indicator), with higher pH lakes tending to be those with Dolerite rock. This supports what was inferred from the multiple density plot in Figure&nbsp;\@ref(fig:Figure4).   

\newpage

**Test Partition Plot** 

```{r Figure7, fig.cap="Partition plot for the test set of Dolerite (D) vs Non Dolerite (N) lakes against water quality indicators pH and Turbidity", fig.pos="center",echo=FALSE}

levels(Test.tas$Dolerite) <- c("Not Dolerite", "Dolerite")
partimat(Dolerite ~ pH + Turbidity , data=Test.tas, method="lda")
```

Figure&nbsp;\@ref(fig:Figure7) shows how the linear discriminant function developed by the training data can be applied to  partition the smaller test set of lakes based on the presence or absence of Dolerite rock. The realistic (unbiased) confusion matrix in Table&nbsp;\ref{tab:Table2} summarizes the overall accuracy with which the classification takes place (accounting for each variable pair, not just pH and Turbidity).

```{r Table2, echo=FALSE, results = 'asis'}

RealisticPredicted <- predict(taslakes.LDA, Test.tas)$class
RCM.tas <- table(RealisticPredicted, Actual=Test.tas$Dolerite)

knitr::kable(RCM.tas,
             caption="Realistic (unbiased) confusion matrix for the LDA partition developed from the presence or absence of Dolerite rock", 
             format="latex", booktabs=TRUE, position = "h!")
```

Table&nbsp;\ref{tab:Table2} shows that 14 of the 16 of the lakes in the test set were correctly classified (7 Non Dolerite corrected predicted as Non Dolerite, 7 Dolerite correctly predicted as Dolerite, 2 Not Dolerite incorrectly predicted as Dolerite). This represents an accuracy of 87.5%.

\newpage

**Map of Lakes Classified by Dolerite LDA** 

``` {r echo=FALSE, include = FALSE}
# Clusters with 49 Lake
levels(Train.tas$Dolerite) <- c("Not Dolerite", "Dolerite")
clusterInfo <- Test.tas
levels(clusterInfo$Dolerite) <- c("Not Dolerite", "Dolerite")
clusterInfo$DolClass <- predict(taslakes.LDA, clusterInfo, taslakes.LDA$prior)$class
test.EDMS <- EDMS[c(3, 7, 9, 17, 24, 27, 29, 30, 31, 40, 41, 42, 46, 48, 49, 50)]
test.SDMS <- SDMS[c(3, 7, 9, 17, 24, 27, 29, 30, 31, 40, 41, 42, 46, 48, 49, 50)]
clusterInfo$EDMS <- test.EDMS
clusterInfo$SDMS <- test.SDMS

```

```{r Figure8, fig.cap="Map of test set of lakes categorised through the LDA by their predicted class: Dolerite (1) or Not Dolerite (0)", out.width = "650px", echo=FALSE}

base_world_tas <- p + geom_polygon(data=Aus_143, aes(x=long, y=lat, group=group), 
                               colour="light green", fill="white")

base_world_tas +
geom_point(data=clusterInfo, 
             aes(x=EDMS, y=SDMS, color = DolClass), size=6, alpha=.7) +
  labs(color = "Dolerite (1) or Not Dolerite (0)")
```

Figure&nbsp;\@ref(fig:Figure8) visually represents the distribution of lakes within the test set based on their predicted classification as either Dolerite or Not Dolerite.

### Tyler's Line LDA 

**Covariance Matrix Equality** \newline

As with the previous LDA, covariance matrices for the two groups of lakes (East or West of Tyler's Line) are examined, with the results provided in the Appendix. Similarly, most of the two matrices matched well but Precipitation and Elevation pairs again were a source of difference between the groups.

**LDA Output** 

``` {r echo=FALSE}


taslakes.LDA.tl <- lda(TylerLine ~ Elevation + Depth + pH + WaterTemp + Precipitation +
                      Turbidity + GlaSed + Felsic + LakeArea + Dolerite, data=Train.tas)
levels(Train.tas$Dolerite) <- c("Not Dolerite", "Dolerite")
taslakes.LDA.tl
```

The prior probabilities in the training set again are approximately equal: 0.529 (18 lakes) for East, and 0.471 (16 lakes) for West. 

Two classes are provided (East and West), so one linear discriminant function is provided to split the feature space of observations. 

**Training Partition Plot** 

```{r Figure9, fig.cap="Partition plot for the training set of East (E) vs West (W) lakes against water quality indicators pH and Turbidity", fig.pos="center",echo=FALSE}

levels(Train.tas$TylerLine) <- c("East", "West")
partimat(TylerLine ~ pH + Turbidity , data=Train.tas, method="lda")
```

Figure&nbsp;\@ref(fig:Figure9) demonstrates the mixed accuracy by which the training set of lakes can be partitioned with a linear function based on the lake's location East or West of Tyler's Line. 

\newpage

**Test Partition Plot**

```{r Figure10, fig.cap="Partition plot for the test set of East (E) vs West (W) lakes against water quality indicators pH and Turbidity", fig.pos="center",echo=FALSE}

levels(Test.tas$TylerLine) <- c("East", "West")
partimat(TylerLine ~ pH + Turbidity , data=Test.tas, method="lda")
```

Figure&nbsp;\@ref(fig:Figure10) shows how the linear discriminant function developed by the training data is able to partition the smaller test set of lakes with mixed accuracy for Tyler's Line. The realistic (unbiased) confusion matrix in Table&nbsp;\ref{tab:Table3} summarizes the accuracy.

```{r Table3, echo=FALSE, results = 'asis'}

RealisticPredicted.tas.tl <- predict(taslakes.LDA.tl, Test.tas)$class
RCM.tas.tl <- table(RealisticPredicted.tas.tl, Actual=Test.tas$TylerLine)

knitr::kable(RCM.tas.tl,
             caption="Realistic (unbiased) confusion matrix for the LDA partition developed from a lake's location East or West of Tyler's Line", 
             format="latex", booktabs=TRUE, position = "h!")
```

Table&nbsp;\ref{tab:Table3} shows that 13 of the 16 of the lakes in the test set were correctly classified (7  East correctly predicted as East, 6 West correctly predicted as West, 1 East wrongly predicted as West, and 2 West wrongly predicted as East). This represents an accuracy of 81.25%, slightly less accurate than the linear function developed from the Dolerite groupings.

\newpage

**Map of Lakes Classified by Tyler's Line LDA**

``` {r echo=FALSE, include = FALSE}

clusterInfo <- Test.tas
levels(Train.tas$Dolerite) <- c("Not Dolerite", "Dolerite")
levels(Test.tas$Dolerite) <- c("Not Dolerite", "Dolerite")
levels(clusterInfo$TylerLine) <- c("East", "West")
levels(clusterInfo$Dolerite) <- c("Not Dolerite", "Dolerite")
clusterInfo$DolClass <- predict(taslakes.LDA, clusterInfo, taslakes.LDA$prior)$class
clusterInfo$TylerClass <- predict(taslakes.LDA.tl, clusterInfo, taslakes.LDA.tl$prior)$class
test.EDMS <- EDMS[c(3, 7, 9, 17, 24, 27, 29, 30, 31, 40, 41, 42, 46, 48, 49, 50)]
test.SDMS <- SDMS[c(3, 7, 9, 17, 24, 27, 29, 30, 31, 40, 41, 42, 46, 48, 49, 50)]
clusterInfo$EDMS <- test.EDMS
clusterInfo$SDMS <- test.SDMS

```

```{r Figure11, fig.cap="Map of test set of lakes categorised through the LDA by their predicted class: East (W) or West (W) of Tyler's Line", out.width = "650px", echo=FALSE}

base_world_tas <- p + geom_polygon(data=Aus_143, aes(x=long, y=lat, group=group), 
                               colour="light green", fill="white")

base_world_tas +
geom_point(data=clusterInfo, 
             aes(x=EDMS, y=SDMS, color = clusterInfo$TylerClass), size=6, alpha=.7) +
  geom_vline(xintercept = 146, color = "red", size = 1, ymin=-44,ymax=-41) +
  labs(color = "East (E) or West (W) of Tyler's Line") 
```

Figure&nbsp;\@ref(fig:Figure11) visually represents the distribution of lakes within the test set based on their predicted classification as either East or West of Tyler's Line. A mis-classified lake may be seen among the many that are located close to the line, along with a clearly mis-classified lake in blue located far to the East or Tyler's Line.

## Factor Analysis

Output from a factor analysis is provided below, and in performed to investigate how many factors are required to sufficiently explain variance across the lakes.

``` {r echo=FALSE}

factanal(taslakes.df.num, factors = 3)
```

According to the factor analysis output, the hypothesis that 3 factors are sufficient to explain variance in the reduced data set cannot be rejected at a 5% significance level.

```{r Figure12, fig.cap="Plot of p-values from testing how sufficient 1, 2 and 3 factors are at explaining variance in the Tasmania lakes data", fig.pos="center",echo=FALSE}

pvalue.f1 <- factanal(taslakes.df.num, factors = 1)$PVAL
pvalue.f2 <- factanal(taslakes.df.num, factors = 2)$PVAL
pvalue.f3 <- factanal(taslakes.df.num, factors = 3)$PVAL
pvalues.f <- data.frame(pvalue.f1, pvalue.f2, pvalue.f3)
x <- c(1, 2, 3)
p.value <- c(pvalue.f1, pvalue.f2, pvalue.f3)

pvalues.f <- data.frame(x, p.value)
ggplot(pvalues.f, aes(x=x, y=p.value)) +
  geom_point(size=3) +
  xlab("Number of factors") + 
  ylab("P-Values")
```

Figure&nbsp;\@ref(fig:Figure12), above, demonstrates that the addition of a third factor is able to raise the p-value above 0.05, suggesting 3 factors are required to explain variance in the data at the 95% significance level. 

In both sets of LDAs, all variables were used to partition between one factor each (Dolerite presence/absence, or east/west of Tyler's Line). The factor analysis suggests that this is may not be enough to sufficiently explain the data. This supports what was observed in the covariance matrices in each LDA (see Appendix): Elevation and Precipitation appeared to vary between both pairs of groups, but these variables were only allowed to explain either differences in the Dolerite or Tyler's Line variables, not control the partitioning themselves. 

This motivates a cluster analysis, which may be able to more freely allow three (or more) factors to control the seperation of lake sub-groups. 

## Cluster Analysis

### Identifying the Optimal Number of Clusters

A silhouette width indicator is used to determine the optimal number of clusters, no longer bound to the two sub-groups specified in each LDA.

```{r Figure13, fig.cap="Optimal number of clusters for the standardised numerical Tasmania lakes data set", fig.pos="center",echo=FALSE}

taslakes.df.num.sc <- scale(taslakes.df.num)
rownames(taslakes.df.num.sc) <- c("And","Ash","Bas","Bel","Chi","CP1","CP2","Cum","Cyg",
                               "Dob","Duc","Eag","Esp","Fif","Fly","For","Gar","Han",
                               "Hea","Her","Hol","Joh","LA","Lad","Lbas","Les","Lil",
                               "Loa","Lyoul","Mac","Mal","Men3","Mic","New","Nic","Osb",
                               "Pla","Ray","Rob","Rod","Sel","Sol1","Sol2","Stra","Ter",
                               "Twi","Twist","Tyoul","Wil","Wom")

fviz_nbclust(taslakes.df.num.sc, pam, method = "silhouette", k.max = 20) + 
  theme_minimal() + ggtitle("Optimal number of clusters")
```

Figure&nbsp;\@ref(fig:Figure13) identifies 5 as the optimal number of clusters in the numerical Tasmania lakes dataset, after the data is standardized. 

### Cluster Plots (With Outlier)

```{r Figure14, out.width = '80%', fig.cap= "Cluster plots (kmeans, top and kmedoid, bottom) for the 50 Tasmanian lakes (5 clusters)", fig.show='hold',fig.align='center', echo=FALSE}

taslakes.kmeans.5 <- kmeans(taslakes.df.num.sc,
                            algorithm="MacQueen",
                            centers=5, iter.max = 100, nstart = 50)

fviz_cluster(taslakes.kmeans.5, data = taslakes.df.num.sc,
             palette = c("dark blue", "green", "orange", "red", "dark green"), 
             geom = "point",
             ellipse.type = "norm", 
             ggtheme = theme_bw())

taslakes.kmedoid.5 <- pam(taslakes.df.num.sc, 5)

fviz_cluster(taslakes.kmedoid.5, data = taslakes.df.num.sc,
             palette = c("dark blue", "green", "orange", "red", "dark green"), 
             geom = "point",
             ellipse.type = "norm", 
             ggtheme = theme_bw())
```

Figure&nbsp;\@ref(fig:Figure14) provides a plot of the 5 clusters generated by both kmeans and a kmedoid algorithms. Though the clusters are reordered in the different methods, both produce very similar clustering which is suggests the differences between subgroups may be genuinely distinct.

However, both methods produce cluster populated only by a single observation. Given that this cluster (cluster 5)  necessarily will have a within-group variance of 0, the between-group variance becomes very uneven. The outlier is removed, and clustering re-calculated. 

### Identifying the Optimal Number of Clusters (Without Outlier)

```{r Figure15, fig.cap="Optimal number of clusters for the standardised numerical Tasmania lakes data set with the outlier (32nd observation, lake 'Men3') removed", fig.pos="center",echo=FALSE}

taslakes.df.num.sc.men3rem <- taslakes.df.num.sc[-32,]

fviz_nbclust(taslakes.df.num.sc.men3rem, pam, method = "silhouette", k.max = 20) + 
  theme_minimal() + ggtitle("Optimal number of clusters")
```

Figure&nbsp;\@ref(fig:Figure15) demonstrates that with the outlier removed (32nd observation, lake 'Men3'), the optimal number of clusters has shifted down to 4. 

### Cluster Plots (Without Outlier)

```{r Figure16, out.width = '80%', fig.cap= "Cluster plots (kmeans, top and kmedoid, bottom) for the 50 Tasmanian lakes without outlier (4 clusters)", fig.show='hold',fig.align='center', echo=FALSE}

taslakes.kmeans.4.men3rem <- kmeans(taslakes.df.num.sc.men3rem,
                            algorithm="MacQueen",
                            centers=4, iter.max = 100, nstart = 50)

fviz_cluster(taslakes.kmeans.4.men3rem, data = taslakes.df.num.sc.men3rem,
             palette = c("green", "orange", "dark blue", "red", "dark green"), 
             geom = "point",
             ellipse.type = "norm", 
             ggtheme = theme_bw())

taslakes.kmedoid.4.men3rem <- pam(taslakes.df.num.sc.men3rem, 4)

fviz_cluster(taslakes.kmedoid.4.men3rem, data = taslakes.df.num.sc.men3rem,
             palette = c("green", "orange", "dark blue", "red", "dark green"), 
             geom = "point",
             ellipse.type = "norm", 
             ggtheme = theme_bw())
```

Figure&nbsp;\@ref(fig:Figure16) provides a plot of the 4 clusters generated by both kmeans and a kmedoid algorithms after the outlier is removed. Again, both encouragingly produce very similar clustering. 

The second cluster, populated by a smaller number of lakes, appears to have a much larger variance than the rest. This is a weakness in the clustering methods given the data. However, this is acceptable as it satisfies the optimal number of clusters (4) which suggests that the second cluster is necessary and distinct in some way.

### Dendrograms

```{r Figure17, fig.cap="Optimal number of clusters for the standardised numerical Tasmania lakes data set with the outlier (32nd observation, lake 'Men3') removed", fig.align='center', out.width = '120%', fig.width = 8.25, fig.show='hold', echo=FALSE}

taslakes.chord.men3rem <- vegdist(taslakes.df.num.sc.men3rem, "euc")
attr(taslakes.chord.men3rem, "labels") <- rownames(taslakes.chord.men3rem)

taslakes.chord.ward.men3rem <- hclust(taslakes.chord.men3rem, method = "ward.D2")

k <- 4

dend <- as.dendrogram(taslakes.chord.ward.men3rem)
clusters <- cutree(dend, k)[order.dendrogram(dend)]

dend %>%
  set("branches_k_color", k = 4, value = unique(clusters) + 1) %>%
  plot
colored_bars(clusters + 1,
             y_shift = -3,
             rowLabels = paste(k, "clusters"))
```

Figure&nbsp;\@ref(fig:Figure17) presents a Ward-linkage dendrogram, placing each lake into one of the 4 clusters determined in the previous analysis. The Ward-linkage method allows the same clustering to be preserved.

Though the horizontal spacing between the lake cannot be interpreted, the branching visualizes similarities and differences between the lakes. For example, the lakes 'Joh' and 'Mac' (far left hand side) are separated by only the final stage of branching, suggesting a similar composition in the numeric predictors. However, the lake 'Rod' (far right) converges even with lakes of the same cluster at a much greater degree of difference. This high within-group variance characteristic of the cluster populated by a smaller number of lakes.

### Map of Lakes Classified by K-Medoid Clusters

```{r Figure18, fig.cap="Map of 49 lakes categorised by their k-medoid clusters", out.width = "650px", echo=FALSE}

EDMS.men3rem <- EDMS[-32]
SDMS.men3rem <- SDMS[-32]

cluster.df <- data.frame(Clusters, EDMS.men3rem, SDMS.men3rem)

base_world_tas <- p + geom_polygon(data=Aus_143, aes(x=long, y=lat, group=group), 
                                   colour="light green", fill="white")

base_world_tas +
  geom_point(data=cluster.df, 
             aes(x=EDMS.men3rem, y=SDMS.men3rem, color = Clusters, size=6, alpha=.7)) 

```

Figure&nbsp;\@ref(fig:Figure18) spatially summaries the cluster analysis against a map of Tasmania. Some of the spatial distribution demonstrated in the LDAs is preserved - with cluster 4 appears to contain more lakes further East - though overall a far more detailed partitioning is provided through this cluster analysis.

## Post-Hoc Cluster Analyses

Factors that control variance between the clusters can be examined visually with box-plots and, where appropriate, with inferential tests (either ANOVA or non-parametric Kruskal-Wallis, and corresponding pairwise tests), starting on the following page. Testing of the ANOVA assumptions can be found in the Appendix.

```{r, echo=FALSE}

pH.men3rem <- pH[-32]
Elevation.men3rem <- Elevation[-32]
Depth.men3rem <- Depth[-32]
WaterTemp.men3rem <- WaterTemp[-32]
Precipitation.men3rem <- Precipitation[-32]
Turbidity.men3rem <- Turbidity[-32]
LakeArea.men3rem <- LakeArea[-32]

Clusters <- factor(taslakes.kmedoid.4.men3rem$cluster)

clusters.boxplot.df <- data.frame(Clusters, Elevation.men3rem, pH.men3rem,
                                  Depth.men3rem, WaterTemp.men3rem, 
                                  Turbidity.men3rem, LakeArea.men3rem)
```

### Cluster Variation: pH

```{r Figure19, fig.cap="Boxplot of the 4 Tasmanian lake clusters against pH", fig.pos="center",echo=FALSE}

ggplot(clusters.boxplot.df, aes(x=Clusters, y=pH.men3rem, 
  group=Clusters, color=Clusters)) + 
  geom_boxplot(notch = TRUE) + 
  xlab("Tasmanian Lake Clusters") + ylab("pH") 
```

Figure&nbsp;\@ref(fig:Figure19) demonstrates that cluster 4 may vary in pH from the other three clusters, characterizing the more alkaline (higher pH) lakes in the sample. This is substantiated in a Kruskal-Wallis and Dunn pairwise test (as the assumption of equal variances was violated). 

The notches appear severely exaggerated, suggesting high uncertainty regarding the position of the median.

```{r, echo=FALSE}

kruskal.test(pH.men3rem ~ Clusters)
```
The Kruskal-Wallis test reports a significant difference somewhere between the clusters, reporting a p-value of ~0. 

```{r, echo=FALSE}

dunnTest(pH.men3rem ~ Clusters,
         method="bonferroni")
```
The Dunn test specifies that there are significant differences (at the 5% significance level) between the pairs of cluster 4 and cluster 1, cluster 4 and cluster 2, and cluster 4 and cluster 3. As indicated in the box-plots, cluster 4 is significantly different (populated with lakes of significantly higher pH) than all of the other three clusters. 

### Cluster Variation: Elevation

```{r Figure20, fig.cap="Boxplot of the 4 Tasmanian lake clusters against Elevation", fig.pos="center",echo=FALSE}

ggplot(clusters.boxplot.df, aes(x=Clusters, y=sqrt(Elevation.men3rem), 
  group=Clusters, color=Clusters)) + 
  geom_boxplot(notch = TRUE) + 
  xlab("Tasmanian Lake Clusters") + ylab("Elevation") 
```

Figure&nbsp;\@ref(fig:Figure20) demonstrates notable variation across all 4 clusters by Elevation. Cluster 2 appears to be populated by lower elevation lakes, while cluster 4 appears to be populated by higher elevation lakes. An ANOVA more closely examines the clusters, as the assumptions of Normality and equal variances are upheld.

Again, the notches appear severely exaggerated, suggesting high uncertainty regarding the position of the median.

```{r, echo=FALSE}

anova.cluster.Elevation <- aov(sqrt(Elevation.men3rem) ~ as.factor(Clusters))
rm(summary)
summary(anova.cluster.Elevation)
```
The ANOVA suggests significant differences in Elevation somewhere between the 4 clusters, reporting a p-value of ~0.

```{r, echo=FALSE}

TukeyHSD(anova.cluster.Elevation, conf.level=.95)
```
The Tukey test provides evidence of significant differences between each group even at a 1% significance level, with very low p-values for each pair. Elevation appears to be a key driver of variation across the clusters.

### Cluster Variation: Lake Area

```{r Figure21, fig.cap="Boxplot of the 4 Tasmanian lake clusters against Lake Area", fig.pos="center",echo=FALSE}

ggplot(clusters.boxplot.df, aes(x=Clusters, y=sqrt(LakeArea.men3rem), 
  group=Clusters, color=Clusters)) + 
  geom_boxplot(notch = TRUE) + 
  xlab("Tasmanian Lake Clusters") + ylab("Lake Area") 
```

Figure&nbsp;\@ref(fig:Figure21) demonstrates that cluster 3 may vary in Lake Area from the other 3 clusters, characterizing larger lakes in the sample. An ANOVA more closely examines the clusters, as the assumptions of Normality and equal variances are upheld.

Again, the notches appear severely exaggerated, suggesting high uncertainty regarding the position of the median.

```{r, echo=FALSE}

anova.cluster.LakeArea <- aov(sqrt(LakeArea.men3rem) ~ as.factor(Clusters))
rm(summary)
summary(anova.cluster.LakeArea)
```
The ANOVA suggests significant differences in Elevation somewhere between the 4 clusters, reporting a p-value of ~0

```{r, echo=FALSE}

TukeyHSD(anova.cluster.LakeArea, conf.level=.95)
```
The Tukey test provides evidence of significant differences (at the 5% significance level) between the pairs of cluster 3 and cluster 1, cluster 3 and cluster 2, and cluster 3 and cluster 4. As indicated in the boxplots, cluster 3 is significantly different (populated with lakes of significantly larger area) than all of the other three clusters. 

### Cluster Variation: Precipitation

```{r Figure22, fig.cap="Boxplot of the 4 Tasmanian lake clusters against Precipitation", fig.pos="center",echo=FALSE}

ggplot(clusters.boxplot.df, aes(x=Clusters, y=Precipitation.men3rem, 
                                group=Clusters, color=Clusters)) + 
  geom_boxplot(notch = TRUE) + 
  xlab("Tasmanian Lake Clusters") + ylab("Precipitation") 
```

Figure&nbsp;\@ref(fig:Figure22) demonstrates that two clusters (1 and 3) may contain lakes that receive higher Precipitation than lakes within the other two clusters (2 and 4). This is investigated further in a Kruskal-Wallis and Dunn pairwise test (as both the assumptions of Normality and equal variances were violated). 

Again, the notches appear severely exaggerated, suggesting high uncertainty regarding the position of the median.

```{r, echo=FALSE}

kruskal.test(Precipitation.men3rem ~ Clusters)
```
The Kruskal-Wallis test reports a significant difference somewhere between the clusters. 

```{r, echo=FALSE}

dunnTest(Precipitation.men3rem ~ Clusters,
         method="bonferroni")
```
The Dunn test specifies that there are significant differences (at the 5% significance level) between the pairs of cluster 1 and cluster 2, cluster 2 and cluster 3, cluster 1 and cluster 4, and cluster 3 and cluster 4. As suggested by the boxplots, the only two non-significance pairwise differences are between cluster 1 and cluster 3, and cluster 2 and cluster 4.

## Combined Lake Classifications 

### Combined Lake Classification Table

```{r Table4, echo=FALSE, results = 'asis'}

reduced.clusterInfo <- clusterInfo[,c(1,11,13)]

reduced.Clusters <- c(1, 2, 3, 4, 2, 3, 2, 3, 4, 3, 1, 2, 2, 3, 3, 2)
reduced.Clusters <- factor(reduced.Clusters)
reduced.clusterInfo$reduced.Clusters <- reduced.Clusters 

colnames(reduced.clusterInfo) <- c("Lake", "Dolerite", "TylerLine", "Cluster ID")

knitr::kable(reduced.clusterInfo,
             caption="All three sets of classifications for the test Tasmanian lakes", 
             format="latex", booktabs=TRUE, position = "h!")

```

Table&nbsp;\ref{tab:Table4} summarizes how the three classification techniques categorize the test set of lakes.


### Combined Lake Classification Map

``` {r echo=FALSE, include = FALSE}
levels(Train.tas$Dolerite) <- c("Not Dolerite", "Dolerite")
clusterInfo <- Test.tas
clusterInfo$MediodsCluster <- pam(Test.tas, 4)$clustering
levels(clusterInfo$Dolerite) <- c("Not Dolerite", "Dolerite")
clusterInfo$DolClass <- predict(taslakes.LDA, clusterInfo, taslakes.LDA$prior)$class
levels(clusterInfo$DolClass) <- c("Not Dolerite", "Dolerite")
clusterInfo$TylerClass <- predict(taslakes.LDA.tl, clusterInfo, taslakes.LDA.tl$prior)$class
test.EDMS <- EDMS[c(3, 7, 9, 17, 24, 27, 29, 30, 31, 40, 41, 42, 46, 48, 49, 50)]
test.SDMS <- SDMS[c(3, 7, 9, 17, 24, 27, 29, 30, 31, 40, 41, 42, 46, 48, 49, 50)]
clusterInfo$EDMS <- test.EDMS
clusterInfo$SDMS <- test.SDMS

```

``` {r echo=FALSE, include = FALSE}
clusterInfo$MediodsCluster <- as.factor(clusterInfo$MediodsCluster)
clusterInfo$MergedClass <- paste(clusterInfo$DolClass, clusterInfo$TylerClass, sep="-")
base_world_tas <- p + geom_polygon(data=Aus_143, aes(x=long, y=lat, group=group), 
                               colour="light green", fill="white")
```

```{r Figure23, fig.cap="Map of test set of lakes categorised by their combined classifications", fig.pos="center",echo=FALSE}

base_world_tas +
geom_point(data=clusterInfo, 
             aes(x=EDMS, y=SDMS, color= MergedClass, shape = MediodsCluster), size=6, alpha=.7) 

```

Figure&nbsp;\@ref(fig:Figure23) visualizes the information in Table&nbsp;\ref{tab:Table4}, plotting the test set of lakes - distinguished by the combination of each of the three classification techniques - on a map of Tasmania. 

# Discussion 

## Comments on the Exploratory Data Analysis

The Exploratory Data Analysis (EDA) meaningfully motivated the LDA and cluster analyses by providing preliminary informal evidence that sub-groupings of lakes may exist within the sample of 50. Figure&nbsp;\@ref(fig:Figure3), the pairs plot, revealed bimodal distributions in pH and Precipitation that suggested distinct populations of lakes may have been combined together. 

Moreover, the correlation plot in Figure&nbsp;\@ref(fig:Figure2) demonstrated strong correlations between water quality indicators and natural factors (e.g. pH and Elevation, pH and Precipitation). Careful not to make causal inferences, this implied that water quality indicators may vary across natural environmental gradients in Tasmania. 

Figure&nbsp;\@ref(fig:Figure4) and Figure&nbsp;\@ref(fig:Figure5) demonstrated two possible partitions for the bimodal pH distribution: Dolerite vs Not Dolerite, or East vs West of Tyler's Line. These multiple density plots suggested that the mean pH for the different sub-groups within each possible may differ along the the real number line (i.e. one being distinctly greater than the other), prompting the use of a linear discriminant analyses to formalize the indications.

Through the EDA, we gathered non-inferential evidence to suggest that water quality indicators across the lakes may vary with natural factors. Developing a robust partitioning methodology to help stakeholders invested in environmental management properly understand the possible role of natural factors in controlling water quality became a key priority that informed our leading questions.

## Discussion on the Linear Discriminant Analyses

The Linear Discriminant Analysis (LDA) on the Dolerite / Not Dolerite partition performed with a higher accuracy rate (87.50%) on the test set of lakes than the LDA on the East / West of Tyler's Line partition (81.25%). However, this only represents the mis-classification of two compared to three lakes, out of 16, respectively. 

This was a surprising result, as Tyler's Line had previously been used as an ecological partition by Rees and Cwynar (2010), while the Dolerite / Not Dolerite partition was used in this report only in response to the EDA. These researchers describe Tyler's Line as a multivariate division that approximates boundaries in several natural factors, not just rock type. However, in support of why the Dolerite / Not Dolerite partition may have performed more slightly more accurately, Rees et al. (2008) had previously suggested that unique combinations of minerals are released when different rock type erode. These minerals then wash into lakes and possibly affect pH, such that rock type may drive lake pH. Our results presented in this report cannot comment on causation within the rock type-pH interaction, however this would be an interesting field of future study.

The LDA outputs included coefficients of the linear discriminant produced in both analyses. The Tyler's Line factor had the largest influence of any variable on the Dolerite function, with a coefficient of -2.44 for the non-reference level 'West'. The Dolerite factor also had the largest influence on the Tyler's Line function, with -4.11 coefficient on 'Dolerite' that was more than twice the magnitude of the next most influential variable. This suggests that we were able to focus the partitions on perhaps the most important variables, but that redundancy may exist between the two: i.e., the Dolerite / Not Dolerite partition may divide the lakes in a similiar way to the Tyler's Line partition. 

Of the two water quality indicators used to represent the lake classifications, pH appeared to control the partition more so than Turbidity in both sets of partition plots (indicated by more horizontal partitions). This consistent with the EDA, where the distribution of Turbidity in the pairs plot (Figure&nbsp;\@ref(fig:Figure3)) did not so obviously appear to capture multiple sub-groups. Moreover, both LDA outputs assign larger coefficient values to pH than Turbidity, again suggesting pH is more influential in controlling the partition. Stakeholders with an interest in managing Tasmanian lake water should note that pH appears to vary more widely than Turbidity, and hence should demand more specific and variable baseline standards than Turbidity, where more homogeneous guidelines could be used.

The key implication of both LDAs is how new lakes can be classified into one of two categories without resource-intensive fieldwork. Of the two options, we recommended the Dolerite / Not Dolerite partition based simply on the improved accuracy in classifying the test set. Using existing geological maps, a stakeholder wishing to estimate the pH (either 'high pH' or 'low pH', with the corresponding group means) of a new lake can inspect the underlying rock type at that particular lake. If the lake has Dolerite rock underneath, a higher pH baseline is predicted. Recognizing now that this lake is likely to be higher in pH, the stakeholder can apply more appropriate water quality standards and management strategies that accommodate the high pH. 

The same could be done for the Tyler's Line partition using classic geographic maps to classify new lakes: with an expanded data set (and hence more lakes to both train and test a classifier), it is possible that Tyler's Line could become the more accurate partitioning method. 

## Discussion on the Cluster Analyses

The cluster analysis was motivated by the factor analysis, which revealed that more than simply one categorical factor may be required to sufficiently explain variation across the lakes at a 5% significance level. The cluster analysis was not limited by the designation of pre-existing classes as in the LDAs, as these may obscure the best partitions or sub-groupings. 

After removing an outlier, the silhouette width indicator suggested four clusters was the ideal number. These four clusters were produced with some overlap demonstrated in plots via both kmeans and kmedoid algorithms (Figure&nbsp;\@ref(fig:Figure16)). Both the cluster plots and the dendrogram shown in Figure&nbsp;\@ref(fig:Figure17) illustrates the uneven variance and between-lake similarities within each cluster. One cluster has 24 of 49 lakes, with many converging at relatively very minor differences. Another cluster, however, contains only four lakes and exhibits much greater variance. Figure&nbsp;\@ref(fig:Figure17), produced via the Ward linkage method, shows how the entirety of the largest cluster converges at a lower cophenetic distance than the distance at which lake 'Rod' converges with the rest of its cluster.

Uneven variance, as exhibits in this cluster analysis, is a clear weakness and perhaps a symptom of the small size (50) of the lakes data set. The original cluster analysis, presented in Figure&nbsp;\@ref(fig:Figure14), demonstrates how the lake 'Men3' could only be classified into a cluster of its own, accentuating the uneven variance problem. This lake was removed from the analysis to provide a more parsimonious representation of the lakes. Practically, it would be inefficient to create seperate sets of management standards for a cluster of just one lake. Accounting for 49 lakes with four clusters is more efficient and economical than 50 lakes with five clusters. With a larger data set of more lakes across Tasmania, however, lakes of sufficiently small differences to lake 'Men3' may have been present to form, at least, a usable fifth cluster. 

The post-hoc cluster analyses provide a useful starting point for investigating what may be most important in characterizing the clusters, though the relatively small number of lakes in some clusters generate very high uncertainties against all variables. Of the most interesting variables presented in this report, cluster 4 (the largest cluster) appears to represent the higher pH lakes and most of the higher Elevation lakes. Cluster 3 (the smallest cluster, with only 4 lakes) appears to be controlled by Lake Area, with lakes of significantly larger size than the other three clusters. The significance of these differences are supported with ANOVA (or non-parametric tests). Importantly, however, for almost every box in every plot the notches appear very exaggerated - oftentimes exceeding the upper or lower quartiles. This represents severe uncertainties on the position of the median. This error should be considered against the hypothesis test results when interpreting differences between clusters.

Unlike the LDAs, this cluster analysis cannot be so easily applied to the process of classifying new lakes. However, it may provide a much more detailed separation of the existing (49) lakes, which in turn can inform more specific water quality standards and lake management practices. For example, the cluster analysis has more precisely constrained the set of high pH lakes (Cluster 4): higher pH standards should be set for these lakes. Stakeholders can therefore choose between using the less precise, more economical LDA partitions or the more precise, less economical clusters (less economical as establishing four sets of water quality standards for the cluster compared to two in the LDA requires more time and resource investment). 

The cluster analysis has also revealed some preliminary insight into which natural factors may be driving variation between the clusters. All clusters are significantly different with regards to Elevation, for example, while two each categorizes high and low Precipitation lakes and Cluster 3 contains lakes with large Areas. This knowledge may indirectly allow future lakes to be categorized by water quality on the basis of its natural factors.

## Problems and Limitations

Specific concerns on both the LDAs and cluster analyses have been integrated into the relevant discussion sections, and a common cause among many of these limitations is the small size of the data set (50 lakes). We believe a larger data set would provide more confidence in the usefulness (or non-usefulness) of linear discriminant classifiers, as more information could be used to teach a partition, and more information could be retained to test the partition's performance. The small data set should be a caution to stakeholders wishing to use either LDA to classify new lakes: the accuracy rate of near-90% may be misleading. Moreover, a larger data set many help to homogenize the variances between the different clusters, as more sub-groups could potentially be identified. The small data set necessarily generated relatively small clusters, which in turn made constraining the variables controlling variation between the clusters difficult.

Other concerns include the non-Normality of most original variables, which limited the potential scope of any analysis, and the conditions under which the data were collected. The lake data used in this report were only collected at one point in time, in 2008. Ideally, we would be able to use continuous data that measured lake quality variables over multiple years as this would likely improve the classifier accuracy even with a sample of only 50 lakes. Rees et al. (2008) - the data collectors - also did not intend for the lake data to participate in classification analyses: the data was originally an auxiliary component of a study focused on determining Chironomid distributions in Tasmania. This may mean that key information that may be useful in building good classifiers - such as influential lakes, or an even coverage of more lake types - was not collected. 

## Conclusions on the Leading Question 

This report posed a two part leading question: can multivariate classification techniques accurately partition Tasmanian lakes and, if so, which natural factors or water quality indicators are characterizing the groupings? Based on the limited data available, we believe we have successfully established preliminary analyses that can answer both parts of the question - a good starting point for future research.

Firstly, both LDAs yielded an accuracy of over ~80% plotted against the water quality indicators, while the clustering revealed only minor overlapping between clusters in the plots. Secondly, likely drivers of variation across the lakes were revealed through both the LDAs (rock type (Dolerite), location (Tyler's Line)) and the cluster analysis (Elevation, pH, Precipitation, Lake Area).

## Applications, Extensions and Further Study

As outlined, the key application of the LDAs is the ability for stakeholders to efficiently estimate the pH of other lakes based only on known factors, like rock type or location, that can be determined with existing resources. The cluster analysis, meanwhile, provides the more precise segregation of the existing set of lakes, without as much use for future classifications. In both cases, stakeholders invested in lake management can establish unique guidelines for managing the different lake groupings based on the characteristics (e.g. pH) that differ between them.

Interesting future studies may include more detailed research into why water quality indicators appear to vary so strongly with natural factors. Better understanding the mechanisms involved will equally help to improve the precision and efficiency of lake management strategies. Moreover, re-running both the LDA and cluster analyses with a larger and more recent set of lakes would improve on the usefulness of the preliminary classifiers established in this report. Other natural factors, particularly numerical factors like Elevation, should also be pursued in further research. The scope of this report meant that such factors could not be a focus, though preliminary evidence supports a potentially strong role in partitioning lakes that should be substantiated. 

Further investigation (and focus) on modelling the distributions of different sub-groups (e.g. the Dolerite / Not Dolerite distributions) may also allow future researchers to apply a more diverse range of classifiers. A Bayesian classification technique, for example - as we know the prior probabilities with each group are similar - may provide a more accurate classifier with which to present environmental stakeholders in Tasmania. 

*The Bibliography follows on the proceeding page*.
\newpage

# Bibliography 

Koehn, J. D., Raymond, S. M., Stuart, I., Todd, C. R., Balcombe, S. R., Zampatti, B. P., Bamford, H., Ingram,\newline\textcolor{white}{white} B. A., Bice, C. M.,     Burndred, K., Butler, G., Baumgartner, L., Clunie, P., Ellis, I., Forbes, J. P., Hutchison,\newline\textcolor{white}{white} M., Koster, W. M., Lintermans, M., Lyon,J. P., … Ye, Q. (2020). A compendium of ecological knowledge\newline\textcolor{white}{white} for restoration of freshwater fishes in Australia’s 
Murray-Darling Basin. In Marine and Freshwater\newline\textcolor{white}{white} Research (Vol. 71, Issue 11). https://doi.org/10.1071/MF20127

Rees, A. B. H., & Cwynar, L. C. (2010). A test of Tyler’s Line - response of chironomids to a pH gradient in \textcolor{white}{white}Tasmania and their potential as a proxy to infer past changes in pH. Freshwater Biology, 55(12).\newline\textcolor{white}{white}https://doi.org/10.1111/j.1365-2427.2010.02482.x

Rees, A. B. H., Cwynar, L. C., & Cranston, P. S. (2008). Midges (Chironomidae, Ceratopogonidae, Chao-\newline\textcolor{white}{white}boridae) as a temperature proxy: A training set from Tasmania, Australia. Journal of Paleolimnology,\newline\textcolor{white}{white}40(4). https://doi.org/10.1007/s10933-008-9222-6


Rees, A. B. H., Cwynar, L. C., & Fletcher, M. S. (2015). Southern Westerly Winds submit to the ENSO\newline\textcolor{white}{white} regime: A multiproxy paleohydrology record from Lake Dobson, Tasmania. Quaternary Science\newline\textcolor{white}{white} Reviews, 126. https://doi.org/10.1016/j.quascirev.2015.08.022

Tibebe, D., Kassa, Y., Melaku, A., & Lakew, S. (2019). Investigation of spatio-temporal variations of\newline\textcolor{white}{white} selected water quality parameters and trophic status of Lake Tana for sustainable management,\newline\textcolor{white}{white} Ethiopia. Microchemical Journal, 148.         https://doi.org/10.1016/j.microc.2019.04.085

*The Appendix follows on the proceeding page*.
\newpage

# Appendix 

## Covariance Matrices (LDA)

```{r Table5, echo=FALSE, results = 'asis'}

Dol0.cov <- cov(taslakes.df.num[Dolerite=="0", c(1:7)])
Dol1.cov <- cov(taslakes.df.num[Dolerite=="1", c(1:7)])

dol.cov.diff <- Dol0.cov - Dol1.cov

dol.cov.diff <- rbind(formatC(as.numeric(dol.cov.diff[1,]),format="f",digits=1),
                      formatC(as.numeric(dol.cov.diff[2,]),format="f", digits=2),
                      formatC(as.numeric(dol.cov.diff[3,]),format="f", digits=2),
                      formatC(as.numeric(dol.cov.diff[4,]),format="f", digits=2),
                      formatC(as.numeric(dol.cov.diff[5,]),format="f", digits=1),
                      formatC(as.numeric(dol.cov.diff[6,]),format="f", digits=2),
                      formatC(as.numeric(dol.cov.diff[7,]),format="f", digits=2))

colnames(dol.cov.diff) <- c("Elevation", "Depth", "pH", "Water Temp", "Precipitation", "Turbidity", "Lake Area")
rownames(dol.cov.diff) <- c("Elevation", "Depth", "pH", "Water Temp", "Precipitation", "Turbidity", "Lake Area")

knitr::kable(dol.cov.diff,
             caption="Difference in covariance matrices (Not Dolerite - Dolerite). Values close to 0 indicate small covariance differences.", 
             format="latex", booktabs=TRUE, position = "h!")
```

```{r Table6, echo=FALSE, results = 'asis'}

tlEast.cov <- cov(taslakes.df.num[TylerLine=="East", c(1:7)])
tlWest.cov <- cov(taslakes.df.num[TylerLine=="West", c(1:7)])

tl.cov.diff <- tlEast.cov - tlWest.cov

tl.cov.diff <- rbind(formatC(as.numeric(tl.cov.diff[1,]),format="f",digits=1),
                     formatC(as.numeric(tl.cov.diff[2,]),format="f", digits=2),
                     formatC(as.numeric(tl.cov.diff[3,]),format="f", digits=2),
                     formatC(as.numeric(tl.cov.diff[4,]),format="f", digits=2),
                     formatC(as.numeric(tl.cov.diff[5,]),format="f", digits=1),
                     formatC(as.numeric(tl.cov.diff[6,]),format="f", digits=2),
                     formatC(as.numeric(tl.cov.diff[7,]),format="f", digits=2))

colnames(tl.cov.diff) <- c("Elevation", "Depth", "pH", "Water Temp", "Precipitation", "Turbidity", "Lake Area")
rownames(tl.cov.diff) <- c("Elevation", "Depth", "pH", "Water Temp", "Precipitation", "Turbidity", "Lake Area")

knitr::kable(tl.cov.diff,
             caption="Difference in covariance matrices (East of Tyler's Line - West of Tyler's Line). Values close to 0 indicate small covariance differences.", 
             format="latex", booktabs=TRUE, position = "h!")
```

## Testing ANOVA Assumptions

Square root transformations are used when such transformations allow ANOVA assumptions to be upheld.

### pH

```{r, echo=FALSE}

# Testing Normality (pH) 
shapiro.test(resid(aov(pH.men3rem ~ as.factor(Clusters))))

# Testing Equal Variances (pH) 
#bartlett.test(pH.men3rem, as.factor(Clusters))
```

### Elevation

```{r, echo=FALSE}

# Testing Normality (Elevation) 
shapiro.test(resid(aov(sqrt(Elevation.men3rem) ~ as.factor(Clusters))))

# Testing Equal Variances (Elevation) 
#bartlett.test(sqrt(Elevation.men3rem), as.factor(Clusters))
```

### Lake Area

```{r, echo=FALSE}

# Testing Normality (Lake Area) 
shapiro.test(resid(aov(sqrt(LakeArea.men3rem) ~ as.factor(Clusters))))

# Testing Equal Variances (Lake Area) 
#bartlett.test(sqrt(LakeArea.men3rem), as.factor(Clusters))
```

### Precipitation

```{r, echo=FALSE}

# Testing Normality (Lake Area) 
shapiro.test(resid(aov(Precipitation.men3rem ~ as.factor(Clusters))))

# Testing Equal Variances (Lake Area) 
#bartlett.test(Precipitation.men3rem, as.factor(Clusters))
```